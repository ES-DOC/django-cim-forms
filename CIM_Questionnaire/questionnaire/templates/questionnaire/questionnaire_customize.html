{% extends "questionnaire/questionnaire_base.html" %}

{% load questionnaire_filters %}
{% load mptt_tags %}

{% block scripts %}

    <!-- ext js -->
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}questionnaire/js/ext/jquery.tagit.min.js"></script>

    <!--custom js -->
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}questionnaire/js/questionnaire_customize.js"></script>

    <script language="javascript">

    /* just setup a minimum of jquery-ui functionality */
    $(document).ready(
        function() {

            var parent = document.body;

            // do this first so that the dialogs appear near the top of the page
            init_dialogs(parent);

            // do this next, so it can happen while other widgets are loading
            render_msg($("#msg"));

            init_widgets(fieldsets,$(parent).find(".collapsible_fieldset"));
            init_widgets_on_show(readonlies,$(parent).find(".readonly"));

            init_widgets(enablers, $(parent).find(".enabler"));
            init_widgets(accordions, $(parent).find(".accordion").not(".fake"));
            init_widgets(sortable_accordions, $(parent).find(".accordion .accordion_header"));
            init_widgets(accordion_buttons, $(parent).find(".subform_toolbar button"));
            init_widgets(tags, $(parent).find(".tags"));
            init_widgets(tabs, $(parent).find(".tabs"));
            init_widgets(users, $(parent).find("#user"));
            init_widgets(buttons, $(parent).find("input.button,a.button"))
            init_widgets(multiselects, $(parent).find(".multiselect"));
            init_widgets(helps, $(parent).find(".help_button"));

            /*  some one-offs for the customizer */
            $("button.customize_subform").button({
                  icons : {primary: "ui-icon-extlink"},
                  text : true
            });

            /* TODO: MOVE THIS STUFF TO SEPARATE FNS */

            var model_customizer_vocabularies = $("div#vocabularies");
            var vocabularies_tabs = $("div#vocabularies_tabs");
            var vocabularies_tabs_headers = $(vocabularies_tabs).find("ul:first li");

            $(vocabularies_tabs).addClass("ui-tabs-vertical ui-helper-clearfix");

            $(model_customizer_vocabularies).find("input.active").each(function() {

                var model_customizer_vocabulary = $(this).closest("div.model_customizer_vocabulary");
                var vocabulary_key = $(model_customizer_vocabulary).find("input.key").val();
                var vocabulary_tab = $(vocabularies_tabs_headers).has("a[href^='#tab_scientific_properties_"+vocabulary_key+"']");
                var vocabulary_index = $(vocabularies_tabs_headers).index(vocabulary_tab);
                var vocabulary_tab_content = $(vocabularies_tabs).children("div.ui-tabs-panel").eq(vocabulary_index);

                if ($(this).is(":checked")) {
                    $(model_customizer_vocabulary).addClass("selected");
                    $(vocabularies_tabs).tabs("enable", vocabulary_index);
                    $(vocabulary_tab_content).removeClass("ui-state-disabled");
                }
                else {
                    $(model_customizer_vocabulary).addClass("ui-state-disabled");
                    $(vocabularies_tabs).tabs("disable", vocabulary_index);
                    $(vocabulary_tab_content).addClass("ui-state-disabled");
                }

                $(this).change(function() {
                    $(model_customizer_vocabulary).toggleClass("ui-state-disabled")
                    $(model_customizer_vocabulary).toggleClass("selected");
                    if ($(model_customizer_vocabulary).hasClass("selected")) {
                        $(vocabularies_tabs).tabs("enable", vocabulary_index);
                        $(vocabulary_tab_content).removeClass("ui-state-disabled");
                    }
                    else {
                        $(vocabularies_tabs).tabs("disable", vocabulary_index);
                        $(vocabulary_tab_content).addClass("ui-state-disabled");
                    }
                });
            });

            $(model_customizer_vocabularies).sortable({
                axis: "y",
                placeholder: "sortable_item",
                cancel : "input.active",
                start : function(e, ui){
                    ui.placeholder.height(ui.item.height());
                    ui.placeholder.width("400");
                },
                stop : function(e,ui) {
                    var sortable_item = ui["item"];
                    $(sortable_item).closest("#vocabularies").find("div.model_customizer_vocabulary").each(function(index, element) {
                        var vocabulary_order = $(this).find("input.order");
                        $(vocabulary_order).val(index)
                    });
                }
            });

            // do this last b/c some of the xpath depends on changes made by the above fns...
            init_errors(parent);

        }

    );

    </script>
{% endblock %} {# /scripts #}

{% block style %}

    <!-- ext css -->
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}questionnaire/css/ext/jquery.tagit.css" />

    <!-- custom css -->
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}questionnaire/css/questionnaire_customize.css" />

    <style type="text/css">
        #questionniare .no_float    { float: none !important; }

        #questionnaire #vocabularies { width: 400px; }
        #questionnaire #vocabularies div.model_customizer_vocabulary { cursor: pointer; padding: 2px; margin: 2px; }
        #questionnaire #vocabularies input.active { }
        #questionnaire #vocabularies input.vocabulary { }
        #questionnaire #vocabularies input.order { text-align: right; }

    </style>

{% endblock %} {# / style #}

{% block title %}
    CIM Questionnaire Customizer
{% endblock %} {# /title #}

{% block content %}

    <div class="hidden_dialog" id="customize_subform_dialog"     title="customize">&nbsp;</div>

    {% block content_title %}
        <div class="title">
            Customize the CIM Questionnaire for <b>{{model_proxy.name|pretty_string}}</b> instances of the <a href="/{{ project.name|lower }}" title="ES-DOC Questionnaire Project Home"><b>{{project.title}}</b></a> Project
        </div> <!-- /.title -->
    {% endblock %} {# /content_title #}


    <div class="documentation">
        <p>
            Use this form to customize how a particular CIM Document for a particular Questionnaire Project is presented.
            Drag-and-drop properties, and categories to specify an order.
            Specify customizable features for each property.
            When you have finished, click the "submit" button at the bottom of the page.
            Invalid entries are indicated using a <span style="color: #ff0000; font-weight: bold;">red</span> font.
            <a href="/customize/help" target="blank"><b>More detailed instructions</b></a> are available.
        </p>
    </div> <!-- /.documentation -->

    <form method="POST" action="">

        {% csrf_token %}

        <!-- some useful stuff for AJAX calls -->
        <input class="hidden" type="text" id="_version_key" name="version_key" value="{{ version.key }}"/>
        <input class="hidden" type="text" id="_project_name" name="project_name" value="{{ project.name|lower }}"/>
        <input class="hidden" type="text" id="_document_type" name="document_type" value="{{ model_proxy.name|lower }}"/>
{#        <input class="hidden" type="text" id="_session_id" name="session_id" value="{{ session_id }}"/>#}
        <input class="hidden" type="text" id="_instance_key" name="instance_key" value="{{ instance_key }}"/>

        <div class="form"> {# wrap everything in div.form, so I can group related fields together #}

            <div class="hidden">
                {% for field in model_customizer_form.get_hidden_fields %} 
                    {{field}}                                              
                {% endfor %}                                               
            </div> <!-- /.hidden -->

            <fieldset class="collapsible_fieldset">
                <legend title="click to toggle content">
                    <span class="title">&nbsp;Customization Details&nbsp;</span>
                </legend>

                <div class="collapsible_fieldset_content">
                    <div class="documentation">
                        <p>
                            This section contains information relating to the <i>customization</i> itself, as opposed to the form being customized.
                        </p>
                    </div> <!-- /.documentation -->

                    <table width="100%">
                        {% for field in model_customizer_form.get_customizer_fields %}
                            <tr class="{% cycle 'odd' 'even' %} field" name="{{field.html_name}}">
                                {% include "questionnaire/_field.html" %}
                            </tr>
                        {% endfor %} {# / field in model_customizer_form.get_customizer_fields #}
                        <tr class="odd field" name="sorted_vocabularies">
                            <td>
                                <span>{{ model_customizer_vocabularies_formset.label }}&nbsp;</span>
                                <div class="documentation">
                                    {{ model_customizer_vocabularies_formset.help_text|safe }}  {# the safe filter prevents inline HTML from being escaped  #}
                                </div>
                            </td>
                            <td>
                                {{ model_customizer_vocabularies_formset.management_form }}
                                <div id="vocabularies" class="sortable ui-widget ui-widget-content ui-corner-all">
                                    {% for model_customizer_vocabulary_form in model_customizer_vocabularies_formset %}
                                        <div class="model_customizer_vocabulary ui-widget ui-widget-content ui-corner-all ui-state-default">
                                            {{ model_customizer_vocabulary_form.id }} <!-- this is a hidden field; it still needs inclusion in order to validate -->
                                            {{ model_customizer_vocabulary_form.vocabulary_key }} <!-- this is also hidden field; it's needed to match the vocabulary_tabs below -->
                                            {{ model_customizer_vocabulary_form.active }}&nbsp;
                                            {{ model_customizer_vocabulary_form.vocabulary }}&nbsp;
                                            {{ model_customizer_vocabulary_form.order }}&nbsp;
                                        </div>
                                    {% endfor %} {# /model_customizer_vocabulary_form #}
                                </div>
                            </td>
                        </tr>
                    </table>

                </div> <!-- / .collapsible_fieldset_content -->

            </fieldset> <!-- / .collapsible_fieldset -->

            <fieldset class="collapsible_fieldset">
                <legend title="click to toggle content">
                    <span class="title">&nbsp;Document Details&nbsp;</span>
                </legend>

                <div class="collapsible_fieldset_content">
                    <div class="documentation">
                        <p>
                            This section contains information relating to the <i>document</i> itself.  This will appear in the title of the document form.
                        </p>
                    </div> <!-- /.documentation -->

                    <table width="100%">
                        {% for field in model_customizer_form.get_document_fields %}
                            <tr class="{% cycle 'odd' 'even' %} field" name="{{field.html_name}}">
                                {% include "questionnaire/_field.html" %}
                            </tr>
                        {% endfor %} {# / field in model_customizer_form.get_document_fields #}
                    </table>

                </div> <!-- / .collapsible_fieldset_content -->

            </fieldset> <!-- / .collapsible_fieldset -->

            <fieldset class="collapsible_fieldset">
                <legend title="click to toggle content">
                    <span class="title">&nbsp;Property Details&nbsp;</span>
                </legend>

                <div class="collapsible_fieldset_content">
                    <div class="documentation">
                        <p>
                            This section contains information relating to the properties of the document. This includes both those defined by the metadata version (ie: the standard CIM content) as well as those defined by the controlled vocabularies (ie: the scientific properties).
                        </p>
                    </div> <!-- /.documentation -->

                    <div class="tabs">
                        <ul> <!-- the tab menu -->
                            <li>
                                <a href="#tab_standard_properties">
                                    Standard Properties (CIM)
                                </a>
                            </li>
                            <li>
                                <a href="#tab_scientific_properties">
                                    Scientific Properties (CV)
                                </a>
                            </li>
                        </ul>

                        <div id="tab_standard_properties">
                            <div class="tab_content">
                                <div class="form">
                                    <div class="documentation">
                                        <p>
                                            These properties are defined by the CIM Schema.
                                        </p>
                                    </div> <!-- /.documentation -->

                                    {% with tags=model_customizer_form.standard_categories_tags content=model_customizer_form.standard_categories_content %}
                                        {% include "questionnaire/_categories.html" %}
                                    {% endwith %}

                                    <!-- this section is pretty similar to the "_formset.html" template -->
                                    <!-- but those are intended for the editing form -->
                                    <!-- the titles, etc. of the accordions are different for the customization form -->
                                    {% with formset=standard_property_customizer_formset %}

                                        {{ formset.management_form }}
                                        {# formset.non_form_errors #}

                                        {% if formset.forms %}

                                            <span class="subform_toolbar ui-widget-header ui-corner-all">
                                                <button type="button" class="sort">sort</button>
                                                <ul class="sort_by">
                                                    <li><a href="#" name="sort_by_name">by name</a></li>
                                                    <li><a href="#" name="sort_by_category">by category</a></li>
                                                    <li><a href="#" name="sort_by_field_type">by field type</a></li>
                                                    <li><a href="#" name="sort_by_order" title="(category order + property order)">by order</a></li>
                                                </ul>
                                                <button type="button" class="expand" title="expand all properties">expand all</button>
                                                <button type="button" class="collapse" title="collapse all properties">collapse all</button>
                                            </span> <!-- /.subform_toolbar -->
                                            <div style="clear: both;">&nbsp;</div>

                                        {% endif %} {# / formset.forms #}

                                        <div class="accordion" prefix="{{formset.prefix}}">
                                            {% for form in formset %}
                                                <h3 class="accordion_header">
                                                    <table width="90%" border="0">
                                                        <tr valign="center">
                                                            {% for field in form.get_header_fields %}
                                                                <td>
                                                                    <b>{{field.label}}:&nbsp;</b>{{ field }}
                                                                </td>
                                                            {% endfor %} {# / field in form.get_header_fields #}
                                                        </tr>
                                                    </table>
                                                </h3> <!-- /.accordion_header -->

                                                <div class="accordion_content">

                                                    <div class="form"> {# wrapping everything in a div.form so I can group together fields belonging to the same model #}

                                                        <div class="hidden">
                                                            {# the fields I explicitly set to hidden #}
                                                            {% for field in form.get_hidden_fields %}
                                                                {{ field }}
                                                            {% endfor %} {# /field #}
                                                            {# and the fields that are hidden by default #}
                                                            {% for hidden_field in form.hidden_fields %}
                                                                {{ hidden_field }}
                                                            {% endfor %} {# /hidden_field #}
                                                        </div>

                                                        <table width="100%">
                                                            {% with type=form.type %}
                                                                {% if type == "ATOMIC" %}
                                                                    {% for field in form.get_atomic_fields %}
                                                                        <tr class="{% cycle 'odd' 'even' %} field" name="{{field.html_name}}" valign="top">
                                                                            {% include "questionnaire/_field.html" %}
                                                                        </tr>
                                                                    {% endfor %} {# / field in form.get_atomic_fields #}
                                                                {% elif type == "ENUMERATION" %}
                                                                    {% for field in form.get_enumeration_fields %}
                                                                        <tr class="{% cycle 'odd' 'even' %} field" name="{{field.html_name}}" valign="top">
                                                                            {% include "questionnaire/_field.html" %}
                                                                        </tr>
                                                                    {% endfor %} {# / field in form.get_enumeration_fields #}
                                                                {% elif type == "RELATIONSHIP" %}
                                                                    {% for field in form.get_relationship_fields %}
                                                                        <tr class="{% cycle 'odd' 'even' %} field" name="{{field.html_name}}" valign="top">
                                                                            {% if field.name|lower == "relationship_show_subform" %}
                                                                                {# this is a copy of the "_field" template, but it adds a 'customize_subform' button to the field #}
                                                                                {% with field_label=field.label field_id=field.html_name %}
                                                                                    <td>
                                                                                        {% if field.help_text %}
                                                                                            {% include "questionnaire/_help.html" %}
                                                                                        {% endif %} {# /field.help_text #}
                                                                                        <span>{{field_label}}&nbsp;</span>
                                                                                    </td>
                                                                                    <td>
                                                                                        {{field}}
                                                                                        <span class="documentation">
                                                                                            Before customizing a subform, be sure to save the current customization.
                                                                                        </span>
                                                                                        <br/>
                                                                                        <button type="button"
                                                                                                class="customize_subform"
                                                                                                name="customize_subform"
                                                                                                title="Customize the subform corresponding to this field."
                                                                                                onClick="customize_property_subform({{ form|get_instance_pk }}, '{{ form.prefix }}-subform_customizer');"
                                                                                        >
                                                                                            customize subform
                                                                                        </button>
                                                                                        {% if field.errors %}
                                                                                            {% include "questionnaire/_error.html" %}
                                                                                        {% endif %} {# / field.errors #}
                                                                                    </td>
                                                                                {% endwith %}

                                                                            {% else %}
                                                                                {% include "questionnaire/_field.html" %}
                                                                            {% endif %}
                                                                        </tr>
                                                                    {% endfor %} {# / field in form.get_relationship_fields #}
                                                                {% endif %}
                                                            {% endwith %}
                                                        </table>

                                                    </div> <!-- /.form -->

                                                </div> <!-- /.accordion_content -->

                                            {% endfor %}
                                        </div> <!-- /.accordion -->
                                    {% endwith %} {# /formset #}
                                </div> <!-- /.form -->
                            </div> <!-- /.tab_content -->
                        </div> <!-- /#tab_standard_properties -->

                        <div id="tab_scientific_properties">
                            <div class="tab_content">
                                <div class="documentation">
                                    <p>
                                        These properties are defined by the CVs. For each CV, categories and properties are divided into separate components using the tabs below.  If a set of categories and properties appears disabled, then the corresponding CV must be activated.
                                    </p>
                                </div> <!-- /.documentation -->

                                <div class="tabs" id="vocabularies_tabs">
                                    <ul  style="width: 120px;"> <!-- the tab menu -->
                                        {% for vocabulary in vocabularies %}
                                            {% with vocabulary_key=vocabulary.get_key %}
                                                <li>
                                                    <a href="#tab_scientific_properties_{{vocabulary_key}}">
                                                        {{ vocabulary.name }}
                                                    </a>
                                                </li>
                                            {% endwith %} {# / vocabulary_key #}
                                        {% endfor %} {# / for vocabulary #}
                                    </ul>

                                    {% for vocabulary in vocabularies %}
                                        {% with vocabulary_key=vocabulary.get_key %}

                                            {% with formsets=scientific_property_customizer_formsets|get_value_from_key:vocabulary_key %}

                                                <div id="tab_scientific_properties_{{vocabulary_key}}" style="width: 1000px;">
                                                    <div class="tab_content">

                                                        <div class="tabs">
                                                            <ul>
                                                                {% for component in vocabulary.component_proxies.all %}
                                                                    {% with component_key=component.get_key %}
                                                                        <li>
                                                                            <a href="#tab_scientific_properties_{{vocabulary_key}}_{{component_key}}">
                                                                                {{component.name}} <span style="font-size: small;">({{formsets|get_number_of_properties_from_key:component_key}})</span>
                                                                            </a>
                                                                        </li>
                                                                    {% endwith %} {# / component_key #}
                                                                {% endfor %} {# / component #}
                                                            </ul>

                                                            {% for component in vocabulary.component_proxies.all %}
                                                                {% with component_key=component.get_key %}
                                                                    <div id="tab_scientific_properties_{{vocabulary_key}}_{{component_key}}">
                                                                        <div class="tab_content">

                                                                            {% with tag_field_name=vocabulary_key|add:'_'|add:component_key|add:'_scientific_categories_tags' content_field_name=vocabulary_key|add:'_'|add:component_key|add:'_scientific_categories_content' %}
                                                                                {% with tags=model_customizer_form|get_field_by_name:tag_field_name content=model_customizer_form|get_field_by_name:content_field_name %}
                                                                                    {% include "questionnaire/_categories.html" %}
                                                                                {% endwith %} {# / tags, content #}
                                                                            {% endwith %} {# / tag_field_name, content_field_name #}

                                                                            <!-- this section is pretty similar to the "_formset.html" template -->
                                                                            <!-- but those are intended for the editing form -->
                                                                            <!-- the titles, etc. of the accordions are different for the customization form -->
                                                                            {% with formset=formsets|get_value_from_key:component_key %}


                                                                                {{ formset.management_form }}
                                                                                {# formset.non_form_errors #}

                                                                                {% if formset.forms %}

                                                                                    <span class="subform_toolbar ui-widget-header ui-corner-all">
                                                                                        <button type="button" class="sort">sort</button>
                                                                                        <ul class="sort_by">
                                                                                            <li><a href="#" name="sort_by_name">by name</a></li>
                                                                                            <li><a href="#" name="sort_by_category">by category</a></li>
                                                                                            <li><a href="#" name="sort_by_order" title="(category order + property order)">by order</a></li>
                                                                                        </ul>
                                                                                        <button type="button" class="expand" title="expand all properties">expand all</button>
                                                                                        <button type="button" class="collapse" title="collapse all properties">collapse all</button>
                                                                                    </span> <!-- /.subform_toolbar -->
                                                                                    <div style="clear: both;">&nbsp;</div>

                                                                                {% endif %} {# / formset.forms #}

                                                                                <div class="accordion" prefix="{{formset.prefix}}">
                                                                                    {% for form in formset %}
                                                                                        <h3 class="accordion_header">
                                                                                            <table border="0" width="90%">
                                                                                                <tr valign="center">
                                                                                                    {% for field in form.get_header_fields %}
                                                                                                        <td>
                                                                                                            <b>{{field.label}}:&nbsp;</b>{{ field }}
                                                                                                        </td>
                                                                                                    {% endfor %} {# / field in form.get_header_fields #}
                                                                                                </tr>
                                                                                            </table>
                                                                                        </h3> <!-- /.accordion_header -->

                                                                                        <div class="accordion_content">
                                                                                            <div class="form"> {# wrapping everything in a div.form so I can group together fields belonging to the same model #}

                                                                                                <div class="hidden">
                                                                                                    the fields I explicitly set to hidden
                                                                                                    {% for field in form.get_hidden_fields %}
                                                                                                        {{ field }}
                                                                                                    {% endfor %} {# /field #}
                                                                                                    and the fields that are hidden by default
                                                                                                    {% for hidden_field in form.hidden_fields %}
                                                                                                        {{ hidden_field }}
                                                                                                    {% endfor %} {# /hidden_field #}
                                                                                                </div>

                                                                                                <table width="100%">
                                                                                                    {% for field in form.get_fields %}
                                                                                                        <tr class="{% cycle 'odd' 'even' %} field" name="{{field.html_name}}" valign="top">
                                                                                                            {% include "questionnaire/_field.html" %}
                                                                                                        </tr>
                                                                                                    {% endfor %} {# / field in form.get_fields #}
                                                                                                    <tr>
                                                                                                        <td colspan="2">
                                                                                                            <fieldset class="collapsible_fieldset extra_attributes">
                                                                                                                <legend title="click to toggle content">
                                                                                                                    <span class="title">&nbsp;Extra Attributes&nbsp;</span>
                                                                                                                </legend>
                                                                                                                <div class="collapsible_fieldset_content">
                                                                                                                    <div class="documentation">
                                                                                                                        <p>
                                                                                                                            Every scientific property can have additional information associated with it.
                                                                                                                        </p>
                                                                                                                    </div> <!-- /.documentation -->
                                                                                                                    <table width="100%">
                                                                                                                        <tr style="text-align: center; text-decoration: underline;">
                                                                                                                            <td width="25%">extra attribute</td>
                                                                                                                            <td style="width: 10% !important;" width="10%">display</td>
                                                                                                                            <td width="10%">allow editing</td>
                                                                                                                            <td width="55%">default value</td>
                                                                                                                        </tr>
                                                                                                                        {% for label,fields in form.get_extra_fieldsets.items %}
                                                                                                                            <tr class="{% cycle 'even' 'odd' %} field">
                                                                                                                                <td width="25%">
                                                                                                                                    {{label}}
                                                                                                                                </td>
                                                                                                                                {% for field in fields %}
                                                                                                                                    <td width="{% cycle '10%' '10%' '55%' %}">
                                                                                                                                        {{field}}
                                                                                                                                        {% if field.errors %}
                                                                                                                                            {% include "questionnaire/_error.html" %}
                                                                                                                                        {% endif %} {# / field.errors #}
                                                                                                                                    </td>
                                                                                                                                {% endfor %}
                                                                                                                            </tr>
                                                                                                                        {% endfor %} {# / field in form.get_extra_fieldsets #}
                                                                                                                    </table>
                                                                                                                </div><!-- /.collapsible_fielset_content -->
                                                                                                            </fieldset>
                                                                                                        </td>
                                                                                                    </tr>
                                                                                                </table>

                                                                                            </div> <!-- /.form -->
                                                                                        </div> <!-- /.accordion_content -->
                                                                                    {% endfor %} {# /form in formset #}
                                                                                </div>

                                                                            {% endwith %} {# / formset #}

                                                                        </div> <!-- /.tab_content -->
                                                                    </div> <!-- /#tab_scientific_properties_{{vocabulary_key}}_{{component_key}} -->
                                                                {% endwith %} {# / component_key #}
                                                            {% endfor %} {# / component #}
                                                        </div> <!-- /.tabs -->
                                                    </div> <!-- /.tab_content -->
                                                </div> <!-- /#tab_scientific_properties_{{vocabulary_key}} -->

                                                {% endwith %} {# /formsets #}

                                        {% endwith %} {# / vocabulary_key #}
                                    {% endfor %} {# / for vocabulary #}

                            </div> <!-- /.tab_content -->
                        </div> <!-- /#tab_scientific_properties -->
                    
                </div> <!-- / .collapsible_fieldset_content -->

            </fieldset> <!-- / .collapsible_fieldset -->

            <div class="submit">
                <input class="button" name="_save" type="submit" value="save"/>
                {% if can_view %}
                    {% with project_name=project.name|lower version_key=version.get_key|lower model_name=model_proxy.name|lower %}
                        {% url 'questionnaire.views.edit_new' project_name version_key model_name  as url_edit_new %}
                        <a class="button" target="_blank" href="{{ url_edit_new }}" title="view a blank {{ model_proxy.name }} document in the Editor using this customization">view in Editor</a>
                    {% endwith %}
                {% endif %} {# /can_view #}
            </div> <!-- /.submit -->
            <div style="clear: both;">&nbsp;</div>

        </div> <!-- /.form -->
    </form>

{% endblock %} {# /content #}

{% block footer %}
    This form is generated by the <a target="_blank" href="https://github.com/ES-DOC/esdoc-questionnaire">CIM Questionnaire</a> (v{{questionnaire_version}}).
    <br/>It uses the CIM Version "{% if version.url %}<a target="_blank" href="{{version.url}}">{% endif %}{{ version }}{% if version.url %}</a> {% endif %}".
    {% if vocabularies %}
    &nbsp;And it includes the Controlled Vocabularies
    {% for vocabulary in vocabularies %}
        {% if not forloop.first %}, {% endif %}
            "<a target="_blank" href="{{vocabulary.file.url}}">{{vocabulary}}</a>"{% endfor %}. {# /vocabulary #}
    {% endif %}
    <br/>For more information please contact: <a href="mailto:es-doc-support@list.woc.noaa.gov">es-doc-support@list.woc.noaa.gov</a>.<br/>
{% endblock %} {# /footer #}

