{% load serialization_filters %}

{% for property in model|get_standard_properties_without_stereotypes:"document" %}
    {% with "questionnaire/serialization/ESDOC_XML/_standard_property.xml" as template %}
        {% include template %}
    {% endwith %}
{% endfor %} {# /property #}

<properties>
    {% with properties=model.scientific_properties.all %}
        {% with categories_and_properties=properties|get_scientific_categories_and_properties_dictionary %}
            {% for category,properties in categories_and_properties.items %}
                {% if not category.is_default_category %}
                    <property ontologyTypeKey="cim.1.software.ComponentProperty">
                        <isRepresented>True</isRepresented>
                        <shortName>{{ category.key }}</shortName>
                        <longName>{{ category.key }}</longName>
                {% endif %}
                    {% for property in properties %}
                        {% with "questionnaire/serialization/ESDOC_XML/_scientific_property.xml" as template %}
                            {% include template %}
                        {% endwith %}
                    {% endfor %}
                {% if not category.is_default_category %}
                    </property>
                {% endif %}
            {% endfor %} {# /category,property #}
        {% endwith %} {# /categories_and_properties #}
    {% endwith %} {# /properties #}
</properties>

<subComponents>
    {% for child in model.get_children.all %}
        {% if child.active %}
            <subComponent>
                {% with model=child %}
                    <{{ model.name }}
    {#                    {% for property in model|get_standard_properties_with_stereotypes:"attribute" %}#}
    {#                        {{ property.name }}="{{ property.atomic_value }}"#}
    {#                    {% endfor %}#}
                    >
                        {% with "questionnaire/serialization/ESDOC_XML/_component.xml" as template %}
                            {% include template %}
                        {% endwith %}
                    </{{ model.name }}>
                {% endwith %} {# /model #}
            </subComponent>
        {% else %}
            <!-- inactive sub-component -->
        {% endif %} {# /child.active #}
    {% endfor %}
</subComponents>

{% if model.is_document %}
    {% with "questionnaire/serialization/ESDOC_XML/_document.xml" as template %}
        {%  include template %}
    {% endwith %}
{% endif %} {# /is_document #}
