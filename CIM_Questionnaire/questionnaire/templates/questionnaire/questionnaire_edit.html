{% extends "questionnaire/questionnaire_view.html" %}

{% load questionnaire_filters %}
{% load mptt_tags %}


{% block scripts %}

    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}questionnaire/js/ext/jquery.dynatree.min.js"></script>
    <!-- TODO: ENCOUNTERED BUG IN jquery.formset.min.js [http://code.google.com/p/django-dynamic-formset/issues/detail?id=54] -->
    <!-- MODIFIED LOCAL CODE TO FIX THIS; SHOULD SEND PATCH -->
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}questionnaire/js/ext/jquery.formset.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}questionnaire/js/questionnaire_edit.js"></script>
    <script language="javascript">

    {% if can_publish %}
        var get_form_section_view = "get_existing_edit_form_section/{{ root_model_id }}";
    {% else %}
        var get_form_section_view = "get_new_edit_form_section";
    {% endif %} {# /can_publish #}

    {% if display_completion_status %}
        start_with_completion_status_displayed = true;
    {% endif %} {# /display_completion_status #}

    /* just setup a minimum of jquery-ui functionality */
    $(document).ready(
        function() {

            var parent = document.body;

            // do this first so that the dialogs appear near the top of the page
            init_dialogs(parent);

            // do this next, so it can happen while other widgets are loading
            render_msg($("#msg"));

            init_widgets(users,$(parent).find("#user"));
            init_widgets(helps,$(parent).find(".help_button"));
            init_widgets(buttons,$(parent).find("input.button"));
            init_widgets(panes,$(parent).find(".pane"));
            init_widgets(treeviews,$(parent).find(".treeview"));

            {% if not vocabularies %}
                {% get_default_vocabulary_key as root_vocabulary_key %}
                {% get_default_component_key as root_component_key %}
                show_pane("{{ root_vocabulary_key }}_{{ root_component_key }}");
            {% endif %} {# / not vocabularies #}

{#        var completion_toggle = $("input#completion_toggle");#}
{#        if (! $(completion_toggle).prop("checked")) {#}
{#            $(completion_toggle).click();#}
{#        }#}
            // do this last b/c some of the xpath depends on changes made by the above fns...
            init_errors(parent);

        }
    );

    </script>

{% endblock %} {# /scripts #}

{% block style %}

    <link rel='stylesheet' type="text/css" href="{{ STATIC_URL }}questionnaire/css/ext/jquery.dynatree.css"/>
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}questionnaire/css/questionnaire_edit.css" />

    <style type="text/css">
        #questionniare .no_float { float: none !important; }
        /* all the interactive features are hidden in the view template */
        /* but not in this, the edit template */
{#        #questionnaire button.add, button.remove, button.replace, button.reset, button.ui-datepicker-trigger { display: none !important; }#}
{#        #questionnaire div.inheritance_options { display: none !important; background: none !important; }#}
{#        #questionnaire div.inheritance_options * { display: none !important; background: none !important; }#}
    </style>

{% endblock %} {# / style #}

{% block title %}
    CIM Questionnaire Editor
{% endblock %} {# /title #}


    {% block content_title %}
        <div class="title">
            Editing {{ model_customizer.model_title|a_or_an }} <b>{{model_customizer.model_title|title}}</b> instance for the <a href="/{{ project.name|lower }}" title="ES-DOC Questionnaire Project Home"><b>{{project.title}}</b></a> Project
        </div> <!-- /.title -->
    {% endblock %} {# /content_title #}

    {% block content_documentation %}
        <div class="documentation">

            <p>
                Use this form to create or modify a {{ model_customizer.model_title|title }} document.
                When you have finished filling in all properties, click the "save" button at the bottom of the page to store a local copy or the "publish" buttom to make the document available for other ES-DOC tools.
                Invalid entries are indicated using a <span style="color: #ff0000; font-weight: bold;">red</span> font.&nbsp;&nbsp;
            </p>
            <p>
                <a href="/edit/help" target="blank"><b>More detailed instructions</b></a> are available.
            </p>

            {%  if model_customizer.model_description %}
                <p style="border: 1px solid #B9E0E3; padding: 6px;">
                    {{model_customizer.model_description|safe}}
                </p>
            {% endif %}
        </div> <!-- /.documentation -->
    {% endblock %} {# /content_documentation #}

    {# IF YOU'RE LOOKING FOR ALL OF THE CONTENT #}
    {# IT'S IN THE "questionnaire_view.html" TEMPLATE #}
    {# THIS TEMPLATE BASICALLY JUST ADDS A SUBMIT/PUBLISH BUTTON TO THAT TEMPLATE #}

    {% block content_submit %}

        <div class="submit">
            <input class="button" name="_save" type="submit" value="save" title="save the current state of this document"/>
            {% if can_publish %}
                <input class="button"  name="_publish" type="submit" value="save & publish" title="save then current state of this document"/>
            {% endif %} {# /can_publish #}
        </div> <!-- /.submit -->
        <div style="clear: both;">&nbsp;</div>

    {% endblock %} {# /content_submit #}
