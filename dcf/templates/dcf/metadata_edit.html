{# this is the edit template for django-cim-forms #}

{% extends "dcf/metadata_base.html" %}

{% load metadata_filters %}

{% block scripts %}
    $(document).ready(
        enableJQueryWidgets()
    );
{% endblock %} {# /scripts #}

{% block title %}
    {{app_name|title|stripSpaces|escape}}::{{form|getModelTitle|stripSpaces|escape}} Entry Form
{% endblock %} {# /title #}

{% block content %}

    <div class="title">
        <u>{{app_name|title|escape}}</u>&nbsp;<u>{{form|getModelTitle|escape}}</u> Entry Form
    </div> <!-- /.title -->

    <p>
        <i>
            Use this form to create or modify an instance of {{form|getModelTitle|escape}} metadata.&nbsp;&nbsp;
            Fill out the fields on each tab from left to right, and on each subform from top to bottom.&nbsp;&nbsp;
            Where applicable, work through each form presented in the navigation menu to the left.&nbsp;&nbsp;
            Fields or subforms with <span style="font-weight: bold;">bold</span> labels are required.&nbsp;&nbsp;
            When you have finished, click the "save" button at the bottom of the page to store a local copy or the "publish" button to send a copy to a public metadata archive.&nbsp;&nbsp;
            Invalid entries are indicated using a <span style="color: #ff0000; font-weight: bold;">red</span> font.&nbsp;&nbsp;
            <a href="/metadata/edit/instructions">More detailed instructions</a> are available.&nbsp;&nbsp;
        </i>
    </p>

    <div id="edit">

    <form method="POST" action="">

        {% csrf_token %}

        <br/>

        <div class="form"> {# wrapping everything in a div.form so I can group together fields belonging to the same model #}

            <div class="vars" style="display: none;">
                <span name="modelName">{{model_name}}</span>
                <span name="appName">{{app_name}}</span>
            </div>


            <div class="tabs">

                <ul> <!-- the tab menu -->
                    {% for field_category in form|get_active_field_categories %}
                        <li>
                            <a href="#tab-{{field_category.getGUID}}" title="{{field_category.description}}">
                                {{field_category.name}}
                            </a>
                        </li>
                    {% endfor %}
                </ul>

                {% for field_category in form|get_active_field_categories %}
                    <div id="tab-{{field_category.getGUID}}">
                        <div class="tab-content">

                            {# this is a bit convoluted b/c #}
                            {# I only have access to the field variable of the form #}
                            {# and not of the model in a template #}
                            {% with fields_of_category=form|get_fields_of_category:field_category %}
                                {% for field in form|custom_visible_fields %}
                                    {% if field.name in fields_of_category %}

                                        {% if field|custom_subform:form %}

                                            {% include "dcf/_subform.html" %}

                                        {% else %}

                                            {% include "dcf/_field.html" %}

                                        {% endif %} {# /field|custom_subform:form #}

                                     {% endif %} {# / field.name in fields_of_category #}
                                {% endfor %} {# /field in form|custom_visible_fields #}
                            {% endwith %} {# /fields_of_type #}

                        </div>
                    </div>
                {% endfor %}

            </div> <!-- /.tabs -->

            {% with uncategorized_fields=form|get_uncategorized_fields %}
                {% for field in form|custom_visible_fields %}
                    {% if field.name in uncategorized_fields %}

                        {% if field|custom_subform:form %}

                            {% include "dcf/_subform.html" %}

                        {% else %}

                            {% include "dcf/_field.html" %}

                        {% endif %} {# /field|custom_subform:form #}

                     {% endif %}
                 {% endfor %}
            {% endwith %}

        </div> <!-- /.form -->

        <div class="submit">
            <input class="button" name="save" type="submit" value="Save" title="Save this document in its current state."/>
            <input class="button" name="submit" type="submit" value="Publish" title="Save this document and publish it to the CIM Repository."/>
        </div> <!-- /.submit -->
        <div style="clear: both;">&nbsp;</div>

    </form>

    </div> <!-- /#edit -->

{% endblock %} {# /content #}
