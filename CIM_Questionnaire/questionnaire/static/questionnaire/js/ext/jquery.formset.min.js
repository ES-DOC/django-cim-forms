/**
 * jQuery Formset 1.3-pre
 * @author Stanislaus Madueke (stan DOT madueke AT gmail DOT com)
 * @requires jQuery 1.2.6 or later
 *
 * Copyright (c) 2009, Stanislaus Madueke
 * All rights reserved.
 *
 * Licensed under the New BSD License
 * See: http://www.opensource.org/licenses/bsd-license.php
 */
(function(e){e.fn.formset=function(t){var n=e.extend({},e.fn.formset.defaults,t),r=n.extraClasses.join(" "),i=e("#id_"+n.prefix+"-TOTAL_FORMS"),s=e("#id_"+n.prefix+"-MAX_NUM_FORMS"),o="input,select,textarea,label,div",u=e(this),a=function(e,t){if(n.extraClasses){e.removeClass(r);e.addClass(n.extraClasses[t%n.extraClasses.length])}},f=function(e,t,n){var r=new RegExp(t+"-(\\d+|__prefix__)-"),i=t+"-"+n+"-";if(e.attr("for"))e.attr("for",e.attr("for").replace(r,i));if(e.attr("id"))e.attr("id",e.attr("id").replace(r,i));if(e.attr("name"))e.attr("name",e.attr("name").replace(r,i))},l=function(e){return e.find(o).length>0},c=function(){return s.length==0||s.val()==""||s.val()-i.val()>0},h=function(t){if(t.is("TR")){t.children(":last").append('<a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a>")}else if(t.is("UL")||t.is("OL")){t.append('<li><a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a></li>")}else{t.append('<a class="'+n.deleteCssClass+'" href="javascript:void(0)">'+n.deleteText+"</a>")}t.find("a."+n.deleteCssClass).click(function(){var t=e(this).parents("."+n.formCssClass),r=t.find('input:hidden[id $= "-DELETE"]'),s=t.siblings("a."+n.addCssClass+", ."+n.formCssClass+"-add"),u;if(r.length){r.val("on");t.hide();u=e("."+n.formCssClass).not(":hidden")}else{t.remove();u=e("."+n.formCssClass).not(".formset-custom-template");i.val(u.length)}for(var l=0,h=u.length;l<h;l++){a(u.eq(l),l);if(!r.length){u.eq(l).find(o).each(function(){f(e(this),n.prefix,l)})}}if(s.is(":hidden")&&c())s.show();if(n.removed)n.removed(t);return false})};u.each(function(t){var r=e(this),i=r.find('input:checkbox[id $= "-DELETE"]');if(i.length){if(i.is(":checked")){i.before('<input type="hidden" name="'+i.attr("name")+'" id="'+i.attr("id")+'" value="on" />');r.hide()}else{i.before('<input type="hidden" name="'+i.attr("name")+'" id="'+i.attr("id")+'" />')}e('label[for="'+i.attr("id")+'"]').hide();i.remove()}if(l(r)){r.addClass(n.formCssClass);if(r.is(":visible")){h(r);a(r,t)}}});if(u.length){var p=!c(),d,v;if(n.formTemplate){v=n.formTemplate instanceof e?n.formTemplate:e(n.formTemplate);v.removeAttr("id").addClass(n.formCssClass+" formset-custom-template");v.find(o).each(function(){f(e(this),n.prefix,"__prefix__")});h(v)}else{v=e("."+n.formCssClass+":last").clone(true).removeAttr("id");v.find('input:hidden[id $= "-DELETE"]').remove();v.find(o).not(n.keepFieldValues).each(function(){var t=e(this);if(t.is("input:checkbox")||t.is("input:radio")){t.attr("checked",false)}else{t.val("")}})}n.formTemplate=v;if(u.attr("tagName")=="TR"){var m=u.eq(0).children().length,g=e('<tr><td colspan="'+m+'"><a class="'+n.addCssClass+'" href="javascript:void(0)">'+n.addText+"</a></tr>").addClass(n.formCssClass+"-add");u.parent().append(g);if(p)g.hide();d=g.find("a")}else{u.filter(":last").after('<a class="'+n.addCssClass+'" href="javascript:void(0)">'+n.addText+"</a>");d=u.filter(":last").next();if(p)d.hide()}d.click(function(){var t=parseInt(i.val()),r=n.formTemplate.clone(true).removeClass("formset-custom-template"),s=e(e(this).parents("tr."+n.formCssClass+"-add").get(0)||this);a(r,t);r.insertBefore(s).show();r.find(o).each(function(){f(e(this),n.prefix,t)});i.val(t+1);if(!c())s.hide();if(n.added)n.added(r);return false})}return u};e.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null}})(jQuery)
